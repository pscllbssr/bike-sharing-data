---
title: "Analysis of bike sharing data"
author: "Elise Gourri, Emilia Marlene Ribeiro Peixoto, Pascal Albisser"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: yes
    toc_float: TRUE
    code_folding: hide
---

```{r libraries, message = FALSE, echo = FALSE}
library(kableExtra)
library(ggplot2)
library(dplyr)
library(data.table)
library(tidyr) 
library(scales)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(knitr.table.format = function() {
  if (knitr::is_latex_output())
    "latex" else "pipe"
})
```

# Dataset

Our Dataset, pls run `scripts/download-data.R` first.

```{r head_data}
data <- fread("data/trips_s.csv")
kable(head(data))
```


```{r trips_per_city}
data %>% 
  ggplot(mapping = aes(x = city, fill = city)) + 
    geom_bar() +
    labs(title = "Number of trips per city")
```


```{r trips_per_month}
data %>% 
  group_by(city, year_month = paste(format(started_at, "%Y-%m"), "-01", sep="")) %>% 
  summarise(n = n()) %>% 
  ggplot(mapping = aes(y = n, x = as.Date(year_month), group = city, colour = city)) + 
    geom_line() +
    geom_point() +
    labs(title = "Sum of trips per city and month", y = "number of trips", x = "")
```

# Weather (Elise)

I started using our main dataset but because I want to summarize data per day. 
I don't know how to group the data because we have a different amount of data per hour 
with the bike rental data...
So for now I will try with the weather_data dataframe. We can ditch all this later if 
we don't use it.

```{r precipitations}
precip <- weather_data %>% filter(date > "2017-12-31") %>%
  mutate(prcp = replace_na(prcp, 0)) %>%
  group_by(city, year_month = as.Date(paste(format(date, "%Y-%m"), "-01", sep=""))) %>% 
  summarise(precipitations = sum(prcp)) 

ggplot(data = precip, mapping = aes(y = precipitations, x = year_month, group = city, colour = city)) + 
  geom_point() +
  geom_line() +
  labs(title = "Sum of precipitations per city and month", y = "precipitations in mm", x = "")
```


```{r temperature}

tempe <- weather_data %>% filter(date > "2017-12-31") %>%
  mutate(temp = replace_na(temp, 0)) %>%
  group_by(city, year_month = as.Date(paste(format(date, "%Y-%m"), "-01", sep=""))) %>% 
  summarise(temp_av = mean(temp)) 

ggplot(data = tempe, mapping = aes(y = temp_av, x = year_month, group = city, colour = city)) + 
  geom_point() +
  geom_line() +
  labs(title = "Average temperature per city and month", y = "temperature in Â°C", x = "")
```


# Linear Model

# Generalised Linear Model with family set to Poisson

# Generalised Linear Model with family set to Binomial

# Generalised Additive Model

# Neural Network

# Support Vector Machine

# Solve an optimisation problem
